<!DOCTYPE html>
<html>
	<head>
		<title>AR Poster with Video + UI</title>
		<!-- A-Frame & AR.js -->
		<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
		<script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1.5.0/dist/aframe.min.js"></script>
		<script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar-nft.js"></script>
		<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>

		<style>
			body {
				margin: 0;
				overflow: hidden;
			}
			.arjs-loader {
				height: 100%;
				width: 100%;
				position: absolute;
				top: 0;
				left: 0;
				background-color: rgba(0, 0, 0, 0.8);
				z-index: 9999;
				display: flex;
				justify-content: center;
				align-items: center;
			}
			.arjs-loader div {
				text-align: center;
				font-size: 1.25em;
				color: white;
			}

			/* Overlay UI */
			.buttons {
				position: absolute;
				bottom: 10px;
				left: 0;
				width: 100%;
				display: flex;
				justify-content: center;
				z-index: 10;
			}
			.control-button {
				padding: 0.5em 1em;
				margin: 0 0.5em;
				border-radius: 6px;
				border: none;
				background: white;
				color: black;
				font-weight: bold;
				cursor: pointer;
			}
		</style>
	</head>

	<body>
		<!-- Loader -->
		<div class="arjs-loader">
			<div>Loading, please wait...</div>
		</div>

		<!-- UI Overlay -->
		<div class="buttons">
			<button class="control-button" id="playPauseBtn">Play</button>
			<button class="control-button" id="redirectBtn">Go Link</button>
		</div>

		<!-- AR.js Scene -->
		<a-scene vr-mode-ui="enabled: false;" embedded renderer="logarithmicDepthBuffer: true;" arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;">
			<!-- Marker (NFT or Pattern) -->
			<a-marker type="pattern" url="./image-tracking/posterPattern.patt" markerhandler>
				<a-video id="videoPlane" src="#myVideo" width="1.5" height="1" position="0 0 0" rotation="0 0 0"></a-video>
			</a-marker>

			<!-- Assets -->
			<a-assets>
				<video id="myVideo" src="./video.mp4" preload="auto" loop crossorigin="anonymous" webkit-playsinline playsinline></video>
			</a-assets>

			<!-- Camera -->
			<a-entity camera></a-entity>
		</a-scene>

		<script>
			AFRAME.registerComponent("markerhandler", {
				init: function () {
					const video = document.querySelector("#myVideo");

					this.el.sceneEl.addEventListener("markerFound", () => {
						console.log("Marker Found!");
						video.play();
					});

					this.el.sceneEl.addEventListener("markerLost", () => {
						console.log("Marker Lost!");
						video.pause();
					});
				},
			});

			window.onload = function () {
				const video = document.querySelector("#myVideo");
				const playPauseBtn = document.querySelector("#playPauseBtn");
				const redirectBtn = document.querySelector("#redirectBtn");

				playPauseBtn.addEventListener("click", () => {
					if (video.paused) {
						video.play();
						playPauseBtn.textContent = "Pause";
					} else {
						video.pause();
						playPauseBtn.textContent = "Play";
					}
				});

				redirectBtn.addEventListener("click", () => {
					window.open("https://www.google.com", "_blank");
				});

				const videoPlane = document.querySelector("#videoPlane");
				videoPlane.addEventListener("click", () => {
					if (video.paused) {
						video.play();
						playPauseBtn.textContent = "Pause";
					} else {
						video.pause();
						playPauseBtn.textContent = "Play";
					}
				});
			};
		</script>
	</body>
</html>
